<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Character Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #0b1220; }
        .app-shell { max-width: 1100px; }
        .glass {
          background: rgba(255,255,255,.06);
          border: 1px solid rgba(255,255,255,.12);
          backdrop-filter: blur(10px);
          border-radius: 16px;
        }
        .muted { color: rgba(255,255,255,.7); }
        .table thead th { white-space: nowrap; }
        .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    </style>
</head>
<body class="text-white">
<div class="container app-shell py-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
            <h1 class="h3 mb-1">Game Character Management</h1>
            <div class="muted small">UI ↔ <span class="mono">/api/characters</span>, <span class="mono">/api/guilds</span> ↔ PostgreSQL</div>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-light btn-sm" id="refreshAllBtn">Refresh</button>
        </div>
    </div>

    <div id="alertHost"></div>

    <div class="glass p-3 mb-3">
        <ul class="nav nav-pills" id="tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="tab-characters" data-bs-toggle="pill" data-bs-target="#pane-characters" type="button" role="tab">
                    Characters
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-guilds" data-bs-toggle="pill" data-bs-target="#pane-guilds" type="button" role="tab">
                    Guilds
                </button>
            </li>
        </ul>
    </div>

    <div class="tab-content">
        <!-- Characters -->
        <div class="tab-pane fade show active" id="pane-characters" role="tabpanel">
            <div class="glass p-3 mb-3">
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <h2 class="h5 mb-0">Create character</h2>
                    <span class="muted small">POST /api/characters</span>
                </div>

                <form id="createForm" class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Type</label>
                        <select class="form-select" id="type">
                            <option value="WARRIOR">WARRIOR</option>
                            <option value="MAGE">MAGE</option>
                            <option value="ROGUE">ROGUE</option>
                        </select>
                    </div>

                    <div class="col-md-5">
                        <label class="form-label">Name</label>
                        <input class="form-control" id="name" placeholder="Guts" required minlength="3" maxlength="50">
                    </div>

                    <div class="col-md-2">
                        <label class="form-label">Level</label>
                        <input class="form-control" id="level" type="number" min="1" max="100" value="1" required>
                    </div>

                    <div class="col-md-2">
                        <label class="form-label">Experience</label>
                        <input class="form-control" id="experience" type="number" min="0" value="0" required>
                    </div>

                    <div class="col-12"><hr class="border-light opacity-25 my-1"></div>

                    <!-- Warrior -->
                    <div class="col-md-4 type-warrior">
                        <label class="form-label">Strength</label>
                        <input class="form-control" id="strength" type="number" min="1" value="10">
                    </div>
                    <div class="col-md-4 type-warrior">
                        <label class="form-label">Armor</label>
                        <input class="form-control" id="armor" type="number" min="0" value="5">
                    </div>
                    <div class="col-md-4 type-warrior">
                        <label class="form-label">Weapon type</label>
                        <input class="form-control" id="weaponType" placeholder="SWORD" value="SWORD">
                    </div>

                    <!-- Mage -->
                    <div class="col-md-4 type-mage d-none">
                        <label class="form-label">Mana</label>
                        <input class="form-control" id="mana" type="number" min="0" value="50">
                    </div>
                    <div class="col-md-4 type-mage d-none">
                        <label class="form-label">Intelligence</label>
                        <input class="form-control" id="intelligence" type="number" min="0" value="15">
                    </div>
                    <div class="col-md-4 type-mage d-none">
                        <label class="form-label">Spell school</label>
                        <input class="form-control" id="spellSchool" placeholder="FIRE" value="FIRE">
                    </div>

                    <!-- Rogue -->
                    <div class="col-md-4 type-rogue d-none">
                        <label class="form-label">Agility</label>
                        <input class="form-control" id="agility" type="number" min="0" value="12">
                    </div>
                    <div class="col-md-4 type-rogue d-none">
                        <label class="form-label">Stealth</label>
                        <input class="form-control" id="stealth" type="number" min="0" value="20">
                    </div>
                    <div class="col-md-4 type-rogue d-none">
                        <label class="form-label">Critical chance</label>
                        <input class="form-control" id="criticalChance" type="number" step="0.01" min="0" value="0.15">
                    </div>

                    <div class="col-12 d-flex gap-2">
                        <button class="btn btn-primary" type="submit">Create</button>
                        <button class="btn btn-outline-light" type="button" id="loadBtn">Load list</button>
                    </div>
                </form>
            </div>

            <div class="glass p-3">
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <h2 class="h5 mb-0">Characters</h2>
                    <div class="d-flex gap-2 align-items-center">
                        <input class="form-control form-control-sm mono" style="width:160px" id="byId" placeholder="id (optional)">
                        <button class="btn btn-outline-light btn-sm" id="loadByIdBtn">Load</button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-dark table-hover align-middle mb-0">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Level</th>
                            <th>XP</th>
                            <th class="text-end">Actions</th>
                        </tr>
                        </thead>
                        <tbody id="charactersTbody">
                        <tr><td colspan="6" class="muted">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Guilds -->
        <div class="tab-pane fade" id="pane-guilds" role="tabpanel">
            <div class="glass p-3 mb-3">
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <h2 class="h5 mb-0">Create guild</h2>
                    <span class="muted small">POST /api/guilds</span>
                </div>
                <div class="row g-2">
                    <div class="col-md-8">
                        <input class="form-control" id="guildName" placeholder="Night Watch">
                    </div>
                    <div class="col-md-4 d-flex gap-2">
                        <button class="btn btn-primary w-100" id="createGuildBtn">Create</button>
                        <button class="btn btn-outline-light w-100" id="loadGuildsBtn">Load</button>
                    </div>
                </div>
            </div>

            <div class="glass p-3">
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <h2 class="h5 mb-0">Guilds</h2>
                    <span class="muted small">GET /api/guilds</span>
                </div>
                <pre class="mb-0 mono" id="guildsPre">Loading...</pre>
            </div>
        </div>
    </div>
</div>

<!-- Edit modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">Edit character (PUT)</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="muted small mb-2">PUT <span class="mono" id="editPath"></span></div>
                <textarea class="form-control mono" id="editJson" rows="14"></textarea>
                <div class="muted small mt-2">Важно: JSON должен содержать <span class="mono">type</span> (WARRIOR/MAGE/ROGUE).</div>
            </div>
            <div class="modal-footer border-secondary">
                <button class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                <button class="btn btn-primary" id="saveEditBtn">Save</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="app.js"></script>
</body>
</html>